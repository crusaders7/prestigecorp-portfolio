<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Audit Tool - Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
        }

        .audit-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            color: #ffffff;
            width: 100%;
        }
    </style>
</head>

<body class="text-white min-h-screen flex items-center justify-center">
    <div class="max-w-2xl mx-auto p-8">
        <h1 class="text-4xl font-bold mb-8 text-center">Site Audit Tool - Test</h1>

        <div class="space-y-4">
            <div>
                <label class="block mb-2">Website URL:</label>
                <input type="url" id="websiteUrl" placeholder="https://example.com" class="audit-input">
            </div>

            <button onclick="testAudit()" class="btn-primary w-full">
                üîç Run Audit Test
            </button>

            <div id="status" class="mt-4 p-4 rounded bg-gray-800 hidden"></div>
            <div id="results" class="mt-4 p-4 rounded bg-gray-800 hidden"></div>
        </div>
    </div>

    <script>
        async function testAudit() {
            const url = document.getElementById('websiteUrl').value.trim();
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');

            // Show status
            statusDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
            statusDiv.innerHTML = '<div class="text-blue-400">üß™ Testing audit functionality...</div>';

            if (!url) {
                statusDiv.innerHTML = '<div class="text-red-400">‚ùå Please enter a URL</div>';
                return;
            }

            try {
                // Test 1: Direct API call (simulated)
                statusDiv.innerHTML += '<div class="text-yellow-400">üì° Testing API call...</div>';

                // Since we're testing locally, let's try different API bases
                const possibleBases = [
                    'http://localhost:3000',
                    'http://127.0.0.1:3000',
                    window.location.origin,
                    ''  // Relative path
                ];

                let success = false;
                let lastError = null;

                for (const base of possibleBases) {
                    try {
                        statusDiv.innerHTML += `<div class="text-gray-400">Trying: ${base || 'relative path'}</div>`;

                        const apiUrl = base ? `${base}/api/audit` : '/api/audit';
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ url: url }),
                            timeout: 10000
                        });

                        if (response.ok) {
                            const data = await response.json();
                            statusDiv.innerHTML += '<div class="text-green-400">‚úÖ API call successful!</div>';

                            resultsDiv.classList.remove('hidden');
                            resultsDiv.innerHTML = `
                                <h3 class="text-xl font-bold mb-4 text-green-400">‚úÖ Audit Results</h3>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>Overall Score: <span class="text-blue-400">${data.overall_score}/100</span></div>
                                    <div>SEO Score: <span class="text-blue-400">${data.seo_score}/100</span></div>
                                    <div>Performance: <span class="text-blue-400">${data.performance_score}/100</span></div>
                                    <div>Accessibility: <span class="text-blue-400">${data.accessibility_score}/100</span></div>
                                    <div>Security: <span class="text-blue-400">${data.security_score}/100</span></div>
                                    <div>Issues: <span class="text-red-400">${data.issues_found?.length || 0}</span></div>
                                </div>
                                <div class="mt-4 text-xs text-gray-400">
                                    API Base Used: ${base || 'relative path'}<br>
                                    Timestamp: ${data.timestamp || 'N/A'}
                                </div>
                            `;
                            success = true;
                            break;
                        }
                    } catch (e) {
                        lastError = e;
                        statusDiv.innerHTML += `<div class="text-red-400">‚ùå ${base || 'relative'}: ${e.message}</div>`;
                    }
                }

                if (!success) {
                    throw lastError || new Error('All API endpoints failed');
                }

            } catch (error) {
                statusDiv.innerHTML += `<div class="text-red-400">üí• Error: ${error.message}</div>`;

                // Show debugging info
                resultsDiv.classList.remove('hidden');
                resultsDiv.innerHTML = `
                    <h3 class="text-xl font-bold mb-4 text-red-400">üîß Debugging Information</h3>
                    <div class="text-sm space-y-2">
                        <div><strong>Current URL:</strong> ${window.location.href}</div>
                        <div><strong>Origin:</strong> ${window.location.origin}</div>
                        <div><strong>Protocol:</strong> ${window.location.protocol}</div>
                        <div><strong>Error:</strong> ${error.message}</div>
                    </div>
                    <div class="mt-4 p-4 bg-yellow-900/20 rounded text-yellow-200 text-sm">
                        <strong>üí° Solutions:</strong><br>
                        1. If protocol is "file:", you need to serve this from a web server<br>
                        2. Run: <code>python -m http.server 3000</code> in the site-audit-tool directory<br>
                        3. Then open: <code>http://localhost:3000</code><br>
                        4. Or deploy to Vercel for production testing
                    </div>
                `;
            }
        }

        // Test on load
        document.addEventListener('DOMContentLoaded', function () {
            const statusDiv = document.getElementById('status');
            statusDiv.classList.remove('hidden');
            statusDiv.innerHTML = `
                <div class="text-blue-400">üåê Page loaded successfully!</div>
                <div class="text-gray-400">Current origin: ${window.location.origin}</div>
                <div class="text-gray-400">Protocol: ${window.location.protocol}</div>
                ${window.location.protocol === 'file:' ?
                    '<div class="text-yellow-400">‚ö†Ô∏è File protocol detected - you need to serve this from a web server!</div>' :
                    '<div class="text-green-400">‚úÖ HTTP protocol detected - should work!</div>'
                }
            `;
        });
    </script>
</body>

</html>